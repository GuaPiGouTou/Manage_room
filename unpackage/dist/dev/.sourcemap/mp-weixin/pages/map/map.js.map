{"version":3,"file":"map.js","sources":["pages/map/map.vue","D:/文档/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWFwL21hcC52dWU"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<map style=\"width: 100%; height: 600px;\" \r\n\t\t:longitude=\"longitude\" :latitude=\"latitude\" \r\n\t\t:markers=\"covers\" :include-points=\"inclde_covers\"  @markertap=\"TapMarker\"\r\n\t\t:scale=\"16\" \r\n\t\t:controls=\"controls\" @controltap=\"returnPostion\" @callouttap=\"TapMarker\"\r\n\t\t></map>\r\n\t\t<button @tap=\"Tapto\">ddd</button>\r\n\t\t<button @tap=\"addmarker\">添加标记点</button>\r\n\t\t<button @tap=\"startrefresh\">点击刷新</button>\r\n\t\t\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tdata:null,\r\n\t\t\t\tlatitude: 1,\r\n\t\t\t\tlongitude: 1,\r\n\t\t\t\told_latitude: 1,\r\n\t\t\t\told_longitude: 1,\r\n\t\t\t\tinclde_covers: [{\r\n\t\t\t\t\tid:1,\r\n\t\t\t\t\tlatitude: 1,\r\n\t\t\t\t\tlongitude: 1,\r\n\t\t\t\t\ticonPath: '../../static/map/redMarker.png',\r\n\t\t\t\t\tcallout: {\r\n\t\t\t\t\t\tcontent: '',\r\n\t\t\t\t\t\ttextAlign: 'center',\r\n\t\t\t\t\t\tcolor: '#00aa00',\r\n\t\t\t\t\t\tborderRadius: 10,\r\n\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\tdisplay: \"ALWAYS\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tcontent: '当前位置',\r\n\t\t\t\t\t\tx:100,\r\n\t\t\t\t\t\tcolor: '#FB3109'\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\twidth: 30,\r\n\t\t\t\t\theight: 30\r\n\t\t\t\t}],\r\n\t\t\t\tcovers: [{\r\n\t\t\t\t\tid:1,\r\n\t\t\t\t\tlatitude: 1,\r\n\t\t\t\t\tlongitude: 1,\r\n\t\t\t\t\ticonPath: '../../static/map/redMarker.png',\r\n\t\t\t\t\tcallout: {\r\n\t\t\t\t\t\tcontent: '',\r\n\t\t\t\t\t\ttextAlign: 'center',\r\n\t\t\t\t\t\tcolor: '#00aa00',\r\n\t\t\t\t\t\tborderRadius: 10,\r\n\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\tdisplay: \"ALWAYS\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tcontent: '当前位置',\r\n\t\t\t\t\t\tx:100,\r\n\t\t\t\t\t\tcolor: '#FB3109'\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\twidth: 30,\r\n\t\t\t\t\theight: 30\r\n\t\t\t\t}],\r\n\t\t\t\t\r\n\t\t\t\tcontrols: [{\r\n\t\t\t\t\tid: 1,\r\n\t\t\t\t\tposition: {\r\n\t\t\t\t\t\tleft: 10,\r\n\t\t\t\t\t\ttop: 570,\r\n\t\t\t\t\t\twidth: 30,\r\n\t\t\t\t\t\theight: 30\r\n\t\t\t\t\t},\r\n\t\t\t\t\ticonPath: \"/static/map/currentLocation_bule.png\",\r\n\t\t\t\t\tclickable: true\r\n\t\t\t\t}],\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t//获取定位权限并定位当前位置\r\n\t\t\tthis.getSetting()\r\n\t\t\t//获取所有标记进行渲染\r\n\t\t\tthis.getAllMark()\r\n\t\t\t\r\n\t\t},\r\n\t\trefreshMarkers() {\r\n\t\t  this.getAllMark();\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tthis.getAllMark()\r\n\t\t\tsetTimeout(()=>{uni.stopPullDownRefresh()},3000)\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//点击刷新\r\n\t\t\tstartrefresh(){\r\n\t\t\t\tuni.startPullDownRefresh()\r\n\t\t\t},\r\n\t\t\t// 将 API 数据转换为地图标记格式\r\n\t\t\tconvertApiDataToMarkers(apiData) {\r\n\t\t\t  return apiData.map(item => {\r\n\t\t\t    return {\r\n\t\t\t      id: item.id, // 使用 API 返回的 id\r\n\t\t\t      latitude: item.latitude, // 使用 API 返回的 latitude\r\n\t\t\t      longitude: item.longitude, // 使用 API 返回的 longitude\r\n\t\t\t      iconPath: '../../static/map/buleMarker.png', // 根据 ID 获取图标\r\n\t\t\t      callout: {\r\n\t\t\t        content: item.title+\"(\"+item.count+\")\", // 使用 API 返回的 title\r\n\t\t\t        textAlign: 'center',\r\n\t\t\t        color: '#00aa00',\r\n\t\t\t        borderRadius: 10,\r\n\t\t\t        borderWidth: 2,\r\n\t\t\t        display: \"ALWAYS\",\r\n\t\t\t      },\r\n\t\t\t      width: 30,\r\n\t\t\t      height: 30,\r\n\t\t\t    };\r\n\t\t\t  });\r\n\t\t\t},\r\n\t\t\t//获取所有标记\r\n\t\t\tgetAllMark(){\r\n\t\t\t\tconst res = wx.cloud.callContainer({\r\n\t\t\t\t  \"config\": {\r\n\t\t\t\t    \"env\": \"prod-7g3ji5ui73a4702f\"\r\n\t\t\t\t  },\r\n\t\t\t\t  \"path\": \"/api/mark/get\",\r\n\t\t\t\t  \"header\": {\r\n\t\t\t\t    \"X-WX-SERVICE\": \"springboot-2wum\",\r\n\t\t\t\t    \"content-type\": \"application/json\"\r\n\t\t\t\t  },\r\n\t\t\t\t  \"method\": \"GET\"\r\n\t\t\t\t})\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tres.then(response=>{\n\t\t\t  // 检查 HTTP 状态码\n\t\t\t  if (response.statusCode === 200) {\n\t\t\t\t// 检查业务状态码\n\t\t\t\tif (response.data.code === \"200\") {\n\t\t\t\t  console.log(\"操作成功:\", response.data.msg);\n\t\t\t\tthis.data = this.convertApiDataToMarkers(response.data.data)\r\n\t\t\t\tthis.covers.push(...this.data)\r\n\t\t\t\tconsole.log(this.covers)\n\t\t\t\t} else {\n\t\t\t\t  console.error(\"业务错误:\", response.data.msg);\n\t\t\t\t this.msg = response.data.msg;\r\n\t\t\t\t this.$refs.error.open('center');\n\t\t\t\t}\n\t\t\t  } else {\n\t\t\t\tconsole.error(\"HTTP 错误:\", response.statusCode);\n\t\t\t\t// 错误处理逻辑...\n\t\t\t  }\n\t\t\t}).catch(error => {\n\t\t\t  console.error(\"标记请求失败:\", error);\n\t\t\t  // 错误处理逻辑...\n\t\t\t});\r\n\t\t\t},\r\n\t\t\t//当前位置定位\r\n\t\t\tgetSetting() {\r\n\t\t\t\twx.getSetting({\r\n\t\t\t\t\tsuccess: (res) => { // 改为箭头函数\r\n\t\t\t\t\t\tif (!res.authSetting['scope.userLocation']) {\r\n\t\t\t\t\t\t\twx.authorize({\r\n\t\t\t\t\t\t\t\tscope: 'scope.userLocation',\r\n\t\t\t\t\t\t\t\tsuccess: () => { // 改为箭头函数\r\n\t\t\t\t\t\t\t\t\tthis.fetchLocation();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.fetchLocation();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tfetchLocation() {\r\n\t\t\t\tuni.getLocation({\r\n\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.latitude = res.latitude;\r\n\t\t\t\t\t\tthis.longitude = res.longitude;\r\n\t\t\t\t\t\tthis.old_latitude = res.latitude;\r\n\t\t\t\t\t\tthis.old_longitude = res.longitude;\r\n\t\t\t\t\t\tthis.inclde_covers[0] = {\r\n\t\t\t\t\t\t\tlatitude: res.latitude,\r\n\t\t\t\t\t\t\tlongitude: res.longitude,\r\n\t\t\t\t\t\t\ticonPath: '../../static/map/redMarker.png',\r\n\t\t\t\t\t\t\twidth: 30,\r\n\t\t\t\t\t\t\theight: 30,\r\n\t\t\t\t\t\t\tcallout: {\r\n\t\t\t\t\t\t\t\tcontent: '',\r\n\t\t\t\t\t\t\t\ttextAlign: 'center',\r\n\t\t\t\t\t\t\t\tcolor: '#00aa00',\r\n\t\t\t\t\t\t\t\tborderRadius: 10,\r\n\t\t\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\t\t\tdisplay: \"ALWAYS\",\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\tcontent: '当前位置',\r\n\t\t\t\t\t\t\t\tx:-25,\r\n\t\t\t\t\t\t\t\tcolor: '#FB3109'\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t this.covers[0] =this.inclde_covers[0]\r\n\t\t\t\t\t\tconsole.log(\"坐标设置完毕\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tconsole.error('定位失败:', err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\treturnPostion() {\r\n\t\t\t\tconsole.log(\"cz\")\r\n\t\t\t\tthis.covers[0] = null\r\n\t\t\t\tthis.inclde_covers[0] = null\r\n\t\t\t\tconsole.log(this.latitude + \"\\n\" + this.longitude)\r\n\t\t\t\tthis.fetchLocation()\r\n\t\t\t},\r\n\t\t\tTapMarker(e){\r\n\t\t\t\tconsole.log(e.markerId)\r\n\t\t\t\twx.redirectTo({\r\n\t\t\t\t\turl:\"/pages/marker/marker?id=\"+e.markerId,\r\n\t\t\t\t\tfail(e) {\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\taddmarker(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"/pages/marker/addMarker/addMarker\"\r\n\t\t\t\t})\r\n\t\t\t\t// uni.chooseLocation({\r\n\t\t\t\t// \tsuccess: function (res) {\r\n\t\t\t\t// \t\tconsole.log('位置名称：' + res.name);\r\n\t\t\t\t// \t\tconsole.log('详细地址：' + res.address);\r\n\t\t\t\t// \t\tconsole.log('纬度：' + res.latitude);\r\n\t\t\t\t// \t\tconsole.log('经度：' + res.longitude);\r\n\t\t\t\t// \t}\r\n\t\t\t\t// });\r\n\t\t\t},\r\n\t\t\t//----------------methods方法分割线-------------------\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>","import MiniProgramPage from 'E:/Manage_Project/demo/demo1/pages/map/map.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","wx","e"],"mappings":"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"}